.TH "src/dcrud/RepositoryFactoryBuilder.c" 3 "Mon Nov 16 2015" "Version 0.0.0" "dcrud" \" -*- nroff -*-
.ad l
.nh
.SH NAME
src/dcrud/RepositoryFactoryBuilder.c \- 
.SH SYNOPSIS
.br
.PP
\fC#include <dcrud/RepositoryFactoryBuilder\&.h>\fP
.br
\fC#include <stdio\&.h>\fP
.br
\fC#include <sys/types\&.h>\fP
.br
\fC#include <setjmp\&.h>\fP
.br

.SS "Functions"

.in +1c
.ti -1c
.RI "dcrudIRepositoryFactory \fBdcrudIRepositoryFactory_Repositories\fP (const char *address, const char *intrfc, unsigned short port, unsigned int id)"
.br
.ti -1c
.RI "dcrudIRepositoryFactory \fBdcrudRepositoryFactoryBuilder_join\fP (const char *address, const char *intrfc, unsigned short port, unsigned int id)"
.br
.in -1c
.SH "Function Documentation"
.PP 
.SS "dcrudIRepositoryFactory dcrudIRepositoryFactory_Repositories (const char *address, const char *intrfc, unsigned shortport, unsigned intid)"

.PP
Definition at line 38 of file Repositories\&.c\&.
.PP
.nf
43 {
44    int trueValue = 1;
45    struct sockaddr_in local_sin;
46    struct ip_mreq mreq;
47 #ifdef _WIN32
48    WSADATA wsaData;
49    check( 0 == WSAStartup( MAKEWORD( 2, 2 ), &wsaData ), __FILE__, __LINE__, "WSAStartup" );
50    atexit( exitHook );
51 #endif
52    Repositories * This = (Repositories*)malloc( sizeof( Repositories ) );
53    This->sckt = socket( AF_INET, SOCK_DGRAM, 0 );
54    check( This->sckt != INVALID_SOCKET, __FILE__, __LINE__, "socket" );
55    check( 0 ==
56       setsockopt( This->sckt, SOL_SOCKET, SO_REUSEADDR, (char*)&trueValue, sizeof( trueValue ) ),
57       __FILE__, __LINE__, "setsockopt(SO_REUSEADDR)" );
58    memset( &local_sin, 0, sizeof( local_sin ) );
59    local_sin\&.sin_family      = AF_INET;
60    local_sin\&.sin_port        = htons( port );
61    local_sin\&.sin_addr\&.s_addr = inet_addr( intrfc );
62    check( 0 == bind( This->sckt, (struct sockaddr *)&local_sin, sizeof( local_sin )),
63       __FILE__, __LINE__, "bind(%s,%d)", intrfc, port );
64    memset( &mreq, 0, sizeof( mreq ));
65    mreq\&.imr_multiaddr\&.s_addr = inet_addr( address );
66    mreq\&.imr_interface\&.s_addr = inet_addr( intrfc );
67    check( 0 == setsockopt( This->sckt, IPPROTO_IP, IP_ADD_MEMBERSHIP, (char *)&mreq, sizeof( mreq )),
68       __FILE__, __LINE__, "setsockopt(IP_ADD_MEMBERSHIP,%s)", address );
69    memset( &This->target, 0, sizeof( This->target ) );
70    This->target\&.sin_family = AF_INET;
71    This->target\&.sin_port = htons( port );
72    This->target\&.sin_addr\&.s_addr = inet_addr( address );
73    This->repositories = collMap_reserve((collComparator)sourceComparator );
74    This->header       = ioByteBuffer_allocate(   2*1024 );
75    This->payload      = ioByteBuffer_allocate(  10*1024 );
76    This->frame        = ioByteBuffer_allocate( 500*1024 );
77    This->id           = id;
78    return (dcrudIRepositoryFactory *)This;
79    (void)intrfc;
80 }
.fi
.SS "dcrudIRepositoryFactory dcrudRepositoryFactoryBuilder_join (const char *address, const char *intrfc, unsigned shortport, unsigned intid)"

.PP
Definition at line 28 of file RepositoryFactoryBuilder\&.c\&.
.PP
.nf
33 {
34    unsigned int mcastAddr;
35    unsigned int * key;
36    dcrudIRepositoryFactory factory;
37    if( !factories ) {
38       factories = collMap_reserve((collComparator)addressComparator );
39    }
40    mcastAddr = (unsigned int)inet_addr( address );
41    factory = collMap_get( factories, &mcastAddr );
42    if( factory ) {
43       return factory;
44    }
45    factory = dcrudIRepositoryFactory_Repositories( address, intrfc, port, id );
46    key = (unsigned int *)malloc( sizeof( unsigned int ));
47    *key = mcastAddr;
48    collMap_put( factories, key, factory );
49    return factory;
50 }
.fi
.SH "Author"
.PP 
Generated automatically by Doxygen for dcrud from the source code\&.
